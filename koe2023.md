---
layout: page
title: Syksyn 2023 koe
inheader: no
permalink: /koe2023/
---

_Arvostelu valmis tehtävien 2 ja 5 osalta, pisteet näkyvät Moodlessa._ Huomaa, että Moodlessa tehtävän n pisteet näkyvät tehtävän n+1 kohdalla.

Muidenkin tehvävien alustavia pisteitä saattaa näkyä Moodlessa. Pisteet ovat <i>alustavia</i> niin kauan kunnes toisin sanotaan, eli ne voivat muuttua mihin tahansa suuntaan, pisteiden katsominen omalla vastuulla.

### Tehtäviin liittyvä tarina

Kurssipalautejärjestelmä Kurppa on osoittautunut menestykseksi ja Helsingin yliopiston (HY) lisäksi sovelluksen ovat ottaneet käyttöön myös Tampereen yliopisto (TAU) ja Jyväskylän yliopisto (JYU). Sovellusta jatkokehitetään nykyään kolmen yliopiston voimin. Jokaisella yliopistolla on oma Kurppabacklog ja product owner. Kehitystyö on jaettu kolmen kuukauden mittaisiin sprintteihin. Sprintti alkaa viikon mittaisella suunnittelutilaisuudella, minkä aikana kukin product owner määrittelee tarkemmalla tasolla backloginsa tärkeimmät user storyt ja estimoi. Tämän jälkeen product ownerit äänestävät, mitkä user storyt otetaan työn alle seuraavaan sprinttiin. 

Kehitystyö on organisoitu siten, että Kurpan frontendiä eli selainpuolen toiminnallisuutta toteutetaan HY:n tiimissä, backendiä eli palvelinpuolen koodia TAU:n tiimissä ja Sisu-järjestelmään tapahtuvasta integraatiosta vastaa JYU:n tiimi. Sprintin ensimmäiset kaksi kuukautta kukin tiimi kehittää omalla vastuualueellaan olevaa koodia. Jokaisella yliopistolla on oma Git-versionhallintajärjestelmänsä, johon koodi on synkronoitu sprintin alussa. Kehitys tehdään kunkin yliopiston omassa Gitissä. 

Sprintin sisällä kunkin yliopiston tiimin työskentely tapahtuu siten, että tiimin Kurppamestari (tiimien käyttämä nimitys Scrum masterille) suunnittelee kunkin user storyn edellyttämät tekniset tehtävät eli taskit sekä niiden koodiin ja arkkitehtuuriin vaatimat muutokset. Hän myös määrää kullekin tehtävälle koodarin tiimin sisältä. Jos koodari ei ymmärrä hänelle määritellyn tehtävän sisältöä, hän kysyy asiasta omalta Kurppamestarilta, joka tarpeen mukaan varmistaa asian oman yliopistonsa Product ownerilta.

Toiminnan optimoimiseksi kukin koodari työskentelee tavallisesti samaan aikaan useamman teknisen tehtävän eli taskin parissa. Koodari luo kutakin taskia varten versionhallintaan ns featurebranchin, jotta sprintin aikana ei syntyisi sekaannuksia muiden koodareiden kanssa. Featurebranchit mergetään kunkin yliopiston omaan Gitiin sprintin niiden valmistuessa. Usein tämä tapahtuu aikalailla viime tingassa.

Sprintin viimeinen kuukausi käytetään koodin integrointiin ja testaamiseen. Tässä vaiheessa koodi kopioidaan kunkin yliopiston omasta versionhallinnasta HY:n Gitiin, minkä sisällä sprintin loppuajan työskentely tapahtuu. Testaus on ulkoistettu Rovaniemeltä ostetulle etänä työskentelevälle testaustiimille. Testaus tapahtuu pääosin käyttöliittymää klikkailemalla. Sprintin lopuksi Kurpasta julkaistaan uusi versio. Kussakin yliopistossa Kurpan tuotantoon viemisestä ja tuotannossa pyörittämisestä vastaa erillinen IT-tiimi. Esim HY:llä tämä tiimi on TIKE:n eli Tietotekniikkakeskuksen DevOps-tiimi. Uuden version julkaisun yhteydessä he saavat koodin oman yliopistonsa Kurppa-tiimiltä ja käynnistävät sen yliopistonsa palvelimella.

Joka neljäs Kurppasprintti on niin sanottu laatusprintti. Sen aikana järjestelmään ei toteuteta uusia ominaisuuksia (poislukien seuraavassa kappaleessa mainitut kiireelliset yllätysstoryt) ja työ keskittyy teknisen velan maksamiseen ja testaustiimin edellisen kolmen sprintin aikana havaitsemien bugien korjailuun.

Aika ajoin yliopistojen korkeimman johdon tietoisuuteen kantautuu Kurpan esim. Jodelissa tai jopa Helsingin Sanomissa saamaa vihaista palautetta. Tämä johtaa usein siihen, että Kurpan menossa olevaan sprinttiin otetaan erittäin kiireelliseksi määriteltyjä user storyjä, jotka on toteutettava välittömästi.

Lupaavan alun jälkeen Kurpan kehitystyö on hidastunut pelottavaa tahtia, tuotteessa on myös havaittu ikäviä laatuongelmia. Myös koodareiden moraali on laskemaan päin, esim. ennen ylpeydellä pidettyjä Kurppa-huppareita ei oikein enää kukaan viitsi pitää päällä, ainakaan julkisilla paikoilla.

### Tehtävä 1

Miten kehittäisit Kurpan sovelluskehityksen prosessia Scrumia, Lean-periaatteita, kurssin osassa 5 käsiteltyjä laajan skaalan ketteriä menetelmiä sekä ketterän manifestin periaatteita noudattaen? Perustele jokainen kehitysehdotus. 

_Tehtävän arvioi Ville Saastamoinen. Omasta arvioinnista voi tarvittaessa kysyä etunimi.sukunimi@helsinki.fi tai Discordissa_

### Tehtävä 2

Miten kehittäisit Kurpan sovelluskehitystyön teknisiä käytänteitä sekä laadunhallinnan menetelmiä kurssilla esitettyjä periaatteita noudattaen? Perustele jokainen kehitysehdotuksesi.
Älä viittaa tässä vastauksessasi edellisen tehtävän vastaukseesi, tehtävät tarkastaa eri henkilö.

_Tehtävän arvioi Matti Luukkainen. Omasta arvioinnista voi tarvittaessa kysyä etunimi.sukunimi@helsinki.fi tai Discordissa_

#### Arvosteluperusteet

Tehtävästä annettiin pisteitä seuraavilla kehitysehdotuksilla:

- Kaikille yliopistoille yhtenen versionhallinta (0.5p)
- Jatkuva integraatio käyttöön (1.5p)
  - Koodi integroidaan päähaaraan tiheästi
  - Eritasoista automatisoitua testausta (yksikkö-, integraatio-, järjestelmätestaus)
  - Järkevämpi branchayskäytäntö (joko Trunk-perustainen tai lyhytikäiset featurebranchit)
- Testauksesta vastuu kehittäjätiimeille (0.5p)
- Sovelluksen julkaisutavan parantaminen (1.5p)
  - CD-pipelinen käyttö
  - Julkaisu tiimien vastuulle (eli "DevOps"-tiimien eliminointi) 
  - Tuotannossa tapahtuva laaduntarkkailu (A/B-testaus, tai canary release)
- Jatkuva huomio koodin sisäiseen laatuun ja laatusprintin eliminointi (0.5p)
- Maininta jonkinlaisesta katselmointikäytänteestä (0.5p)
  - joko manuaalinen esim. pull requestit tai automatisoitu kuten Pylint
- Tiimirakenteen muokkaaminen siten että tiimit ovat cross functional eli monitaitoisia (0.5p)
- Koodareiden rinnakkaisen työn minimointi (0.5p)
- Hyvin määritelty Definition of Done (0.5p)
- Tiimien autonomian kasvatus mm. ohjelmiston arkkitehtuurin suhteen (0.5p)

Lisäksi muista hyvistä ajatuksista saattoi saada pisteitä.

Perustelujen laatu vaikuttaa pisteisiin. Koska tehtävän maksimipistemäärä on 4.5, ei kaikkia yllämainittuja kohtia tarvitse huomioida täysiin pisteisiin päästäkseen.

### Tehtävä 3

Kuvitellaan, että ollaan Kurppa-järjestelmän kehityksen alkuvaiheessa. Sinut on nimetty Kurpan product owneriksi. Kirjoita kaksi hyvää user storyä Kurpalle. Saat keksiä niiden kuvaaman toiminnallisuuden itse. Toinen user storyistä on sellainen, että sen kuvaama toiminnallisuus tullaan toteuttamaan seuraavassa sprintissä. Toinen storyistä tullaan toteuttamaan aikaisintaan kahden vuoden päästä.

Perustele, miksi kirjoittamasi storyt ovat hyviä.

_Tehtävän arvioi Hannah Leinson. Omasta arvioinnista voi tarvittaessa kysyä etunimi.sukunimi@helsinki.fi tai Discordissa_

### Tehtävä 4

(a) Aloittelevaa ohjelmoijaa varoitellaan usein siitä, että samaa koodinpätkää ei kannata copypasteta moneen paikkaan yhden ohjelman sisällä. Mikä on syynä tälle ”kiellolle”? Onko olemassa myös tilanteita, joissa copypaste voi olla hyväksyttävää tai jopa kannatettavaa? 

(b) Kurssilla puhutaan kahdesta erilaisesta tavasta versionhallinnan hyödyntämiseen: feature branchit ja trunk based development. Kerro, mistä on kyse. Kerro molempien hyvistä ja huonoista puolista.

(c) Ohjelmistossa on käytössä relaatiotietokanta. Lisäksi ohjelmisto hakee säätietoja Ilmatieteen laitoksen avoimesta rajapinnasta. Kerro, miten ohjelmiston automatisoidussa testauksessa tulisi toimia tietokannan ja rajapintojen suhteen.

_Tehtävän arvioi Valtteri Kantanen. Omasta arvioinnista voi tarvittaessa kysyä etunimi.sukunimi@helsinki.fi tai Discordissa_

### Tehtävä 5

Palataan ajassa hieman taaksepäin. Linkin https://gist.github.com/mluukkai/9093b1b3715b556ce85af32b571fb6de takana on koodia Kurpan kehityksen alkuajoilta. Kehitystiimin velositeetti oli projektin alussa huipputasoa, mutta Kurppamestari on huomannut vauhdin hiljenneen edellisten sprinttien aikana. Syyksi hidastumiseen diagnosoidaan koodiin pesiytynyt tekninen velka.

Refaktoroi koodissa olevaa luokkaa Kurssi sisäiseltä laadultaan paremmaksi soveltaen suunnittelumalleja tai muita tilanteeseen sopivia ratkaisuja.

_Tehtävän arvioi Riku Rauhala. Omasta arvioinnista voi tarvittaessa kysyä etunimi.sukunimi@helsinki.fi tai Discordissa_

#### Arvosteluperusteet

Koodin refaktoroinnissa on annettu pisteitä seuraavista asioista:

- tiedoston käsittely
  - toiminnallisuus siirretty omaan luokkaan (2p)
  - toiminnallisuutta ei ole siirretty, mutta eriytetty metodeihin
    - tiedoston lukeminen tehty omassa metodissa (0.5p)
    - tiedostoon kirjoitus eriytetty metodiin (1p)
- toisteisuuden eliminointi
  - palautteen hakeminen (1p)
  - yhteenvedon tulostus (1p)
- muuttujien osuvampi nimeäminen (1p)
  - `p` -> `palaute`
  - `x`, `y` -> `alaraja`, `ylaraja` tms.
  - `x` -> `summa` tms.
  - täysiin pisteisiin vaadittu vähintään kahden näistä ottamista huomioon tai järkevää muuttujien nimeämistä mahdollisissa omissa funktioissa/luokissa

Hyvällä yrityksellä voi saada puolikkaan pisteen. Suoraan pisteytettävien asioiden lisäksi muista osuvista parannuksista on saanut maksimissaan yhden pisteen. Mahdollisia lisäansioita ovat esimerkiksi:

- tyyppiannotaatiot
- docstring
- järkevät apufunktiot
- paranneltu poikkeuskäsittely
- erillisten luokkien luonti esim. Opiskelija tai Palaute

Jos koodia ei ole korjattu mutta puutteita listattu, on tehtävästä mahdollista saada maksimissaan yksi piste. Tehtävän _maksimipistemäärä_ on 4.5, eli kaiken ei täydy olla täydellistä saadakseen täydet pisteet.

#### Malliratkaisu

Täydet pisteet tuova ratkaisu voi näyttää esimerkiksi tältä:

```python
class Tiedostonkasittelija:
    def __init__(self, tiedoston_nimi):
        self.__tiedosto = f"{tiedoston_nimi}.csv"

    def lue(self):
        palautteet = []
        try:
            with open(self.__tiedosto, "r") as tiedosto:
                for rivi in tiedosto:
                    osat = rivi.split(";")
                    self.__palautteet.append({
                        "opiskelija": osat[0], 
                        "arvosana": int(osat[1]), 
                        "kommentti": osat[2]
                    })
        except FileNotFoundError:
            print("Tiedostoa ei löydy")
        except Exception:
            pass
        return palautteet

    def tallenna(self, palautteet):
        with open(self.__tiedosto, "w") as tiedosto:
            for palaute in palautteet:
                tiedosto.write(f"{palaute['opiskelija']};{palaute['arvosana']};{palaute['kommentti']};\n")

class Kurssi:
    def __init__(self, nimi, vuosi):
        self.__nimi = nimi
        self.__vuosi = vuosi
        self.__tiedostonkasittelija = Tiedostonkasittelija(nimi)
        self.__palautteet = self.__tiedostonkasittelija.lue()

    def anna_palaute(self, uusi_palaute):
        for palaute in self.__palautteet:
            if palaute["opiskelija"] == uusi_palaute["opiskelija"]:
                return False
        kommentti = uusi_palaute["kommentti"] if "kommentti" in uusi_palaute else ""
        self.__palautteet.append({
            "opiskelija": uusi_palaute["opiskelija"], 
            "arvosana": uusi_palaute["arvosana"], 
            "kommentti": kommentti
        })
        self.__tiedostonkasittelija.tallenna(self.__palautteet)
        return True

    def muuta_palautetta(self, muutettu_palaute):
        for palaute in self.__palautteet:
            if palaute["opiskelija"] == muutettu_palaute["opiskelija"]:
                kommentti = muutettu_palaute["kommentti"] if "kommentti" in muutettu_palaute else ""
                palaute["arvosana"] = muutettu_palaute["arvosana"]
                palaute["kommentti"] = kommentti
                self.__tiedostonkasittelija.tallenna(self.__palautteet)
                return True
        return False

    def hae_palaute(self, opiskelija):
        for palaute in self.__palautteet:
            if palaute["opiskelija"] == opiskelija:
                return palaute
        return None

    def hae_kriteerilla(self, kriteeri):
        return [palaute for palaute in self.__palautteet if kriteeri(palaute)]
    
    def hae_kommentin_sisaltavat_palautteet(self):
        return self.hae_kriteerilla(lambda palaute: len(palaute["kommentti"]) > 0)

    def hae_palautteet_joiden_arvosana(self, arvosana):
        return self.hae_kriteerilla(lambda palaute: palaute["arvosana"] == arvosana)

    def hae_palautteet_joiden_arvosana_valilla(self, alaraja, ylaraja):
        return self.hae_kriteerilla(lambda palaute: palaute["arvosana"] >= alaraja and palaute["arvosana"] <= ylaraja)

    def yhteenveto(self):
        print(f"{self.__nimi}, {self.__vuosi}")
        print("============")
        print("palautteita annettiin", len(self.__palautteet), "kappaletta")

        summa = sum([palaute["arvosana"] for palaute in self.__palautteet])
        
        print("keskiarvo ", summa / len(self.__palautteet))

        print("\njakauma")
        for arvosana in range(5, 0, -1):
            print(f"{arvosana}: {len(self.hae_palautteet_joiden_arvosana(arvosana)) * '*'}")

        print("\nkommentit")
        for palaute in self.__palautteet:
            if len(palaute["kommentti"]) > 0:
                print("  " + palaute["kommentti"])
```
